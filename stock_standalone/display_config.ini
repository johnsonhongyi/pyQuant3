[lines]
line0 = ã€{code}ã€‘{name}:{close}
line1 = â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
line2 = ğŸ“Š æ¢æ‰‹ç‡: {ratio}
line3 = ğŸ“Š æˆäº¤é‡: {volume}
line4 = ğŸ”´ è¿é˜³: {red}
line5 = ğŸ“ˆ çªç ´å¸ƒæ—: {boll}
line6 =   signal: {signal_icon} (low<10 & C>5)
line7 =   Upper:  {upper}
line8 =   Lower:  {lower}
line9 = ğŸš€ çªç ´: {breakthrough} (high > upper)
line10 = ğŸ’ª å¼ºåŠ¿: {strength} (L1>L2 & H1>H2)

[colors]
line0 = blue
line1 = black
line2 = red
line3 = green
line4 = red
line5 = orange
line6 = orange
line7 = orange
line8 = orange
line9 = purple
line10 = purple


[lines]
line0 = ã€{code}ã€‘{name}:{close}
line1 = â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
line2 = ğŸ“Š {ratio_label}: {ratio}
line3 = ğŸ“Š {volume_label}: {volume}
line4 = ğŸ”´ {red_label}: {red}
line5 = ğŸ“ˆ {boll_label}: {boll}
line6 =   signal: {signal_icon} (low<10 & C>5)
line7 =   Upper:  {upper}
line8 =   Lower:  {lower}
line9 = ğŸš€ {breakthrough_label}: {breakthrough}
line10 = ğŸ’ª {strength_label}: {strength}

[colors]
line0 = blue
line1 = black
line2 = red
line3 = green
line4 = red
line5 = orange
line6 = orange
line7 = orange
line8 = orange
line9 = purple
line10 = purple

[labels]
ratio_label = æ¢æ‰‹ç‡
volume_label = æˆäº¤é‡
red_label = è¿é˜³
boll_label = çªç ´å¸ƒæ—
breakthrough_label = çªç ´
strength_label = å¼ºåŠ¿


import configparser
import os

class DefaultDict(dict):
    """æ¨¡æ¿å­—æ®µç¼ºå¤±è¿”å› 'N/A'"""
    def __missing__(self, key):
        return 'N/A'

def load_display_config_dynamic(config_file, stock_data):
    config = configparser.ConfigParser()
    config.read(config_file, encoding="utf-8")

    # åˆå¹¶ stock_data å’Œ labels
    data_dict = dict(stock_data)
    if 'labels' in config:
        data_dict.update(config['labels'])

    lines = []
    colors = []

    for key in sorted(config['lines'], key=lambda x: int(x.replace('line',''))):
        template = config['lines'][key]
        line_text = template.format_map(DefaultDict(data_dict))
        color_value = config['colors'].get(key, 'black')
        lines.append(line_text)
        colors.append(color_value)

    return lines, colors

# ä½¿ç”¨ç¤ºä¾‹
# stock_data = {'code': '600001', 'name': 'æµ‹è¯•', 'close': 10.5, 'volume': 12345, 'ratio': 0.56, ...}
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
config_file = os.path.join(BASE_DIR, "display_config.ini")
lines, colors = load_display_config_dynamic(config_file, stock_data)
